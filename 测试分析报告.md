# 宿舍管理系统单元测试分析报告

## 1. 概述

本报告针对宿舍管理系统的单元测试和集成测试进行分析。单元测试涵盖了系统中的四个核心服务模块：
- BuildingService (宿舍楼管理)
- DormService (宿舍管理)
- StudentService (学生管理)
- UserService (用户管理)

集成测试采用 Spring Boot Test 框架，主要验证系统各个模块之间的交互和协作，包括：
- 完整的宿舍分配流程
- 宿舍调整流程
- 宿舍楼容量管理

集成测试使用 `@SpringBootTest` 注解进行完整的应用程序上下文加载，并使用 `@Transactional` 注解确保测试数据的隔离性。

## 2. 单元测试分析

### 2.1 宿舍楼管理模块 (BuildingServiceTest)
- 测试用例数量：5个
- 主要测试功能：
  - 获取所有宿舍楼信息
  - 分页查询宿舍楼
  - 新增宿舍楼
  - 编辑宿舍楼
  - 批量删除宿舍楼

#### 测试用例详情表

| 测试用例ID | 测试用例名称 | 测试目的 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 |
|------------|-------------|----------|----------|----------|----------|----------|
| BLD-001 | getBuildingAll_Success | 验证获取所有宿舍楼信息功能 | 1. Mock BuildingDao<br>2. 准备测试数据 | 1. 模拟DAO层返回两个宿舍楼数据<br>2. 调用getBuildingAll()方法 | 1. 返回列表不为空<br>2. 列表包含2个宿舍<br>3. 宿舍楼信息正确 | 测试通过 |
| BLD-002 | getBuildingPage_Success | 验证分页查询宿舍楼功能 | 1. Mock BuildingDao<br>2. 准备查询条件 | 1. 设置查询条件"1号楼"<br>2. 调用getBuildingPage方法 | 1. 返回分页对象不为空<br>2. 数据列表包含2条记录<br>3. 正确调用DAO层方法 | 测试通过 |
| BLD-003 | saveBuilding_Success | 验证新增宿舍楼功能 | 1. Mock BuildingDao<br>2. 准备新宿舍楼数据 | 1. 创建新宿舍楼对象<br>2. 调用saveBuilding方法 | 1. 返回值为1<br>2. DAO层保存方法被调用 | 测试通过 |
| BLD-004 | editBuilding_Success | 验证编辑宿舍楼功能 | 1. Mock BuildingDao<br>2. 准备更新数据 | 1. 创建更新的宿舍楼对象<br>2. 调用editBuilding方法 | 1. 返回值为1<br>2. DAO层更新方法被调用 | 测试通过 |
| BLD-005 | deleteBuildings_Success | 验证批量删除宿舍楼功能 | 1. Mock BuildingDao<br>2. 准备删除数据列表 | 1. 创建要删除的宿舍楼列表<br>2. 调用deleteBuildings方法 | 1. 返回值为2<br>2. DAO层删除方法被正确调用 | 测试通过 |

### 2.2 宿舍管理模块 (DormServiceTest)
- 测试用例数量：5个
- 主要测试功能：
  - 获取所有宿舍信息
  - 分页查询宿舍
  - 新增宿舍
  - 编辑宿舍
  - 批量删除宿舍

#### 测试用例详情表

| 测试用例ID | 测试用例名称 | 测试目的 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 |
|------------|-------------|----------|----------|----------|----------|----------|
| DRM-001 | getDormAll_Success | 验证获取所有宿舍信息功能 | 1. Mock DormDao<br>2. 准备测试数据 | 1. 模拟DAO层返回两个宿舍数据<br>2. 调用getDormAll()方法 | 1. 返回列表不为空<br>2. 列表包含2个宿舍<br>3. 宿舍信息正确<br>4. 宿舍号分别为"101"和"102" | 测试通过 |
| DRM-002 | getDormPage_Success | 验证分页查询宿舍功能 | 1. Mock DormDao<br>2. 准备查询条件 | 1. 设置查询条件"101"<br>2. 调用getDormPage方法<br>3. 设置分页参数(1,10) | 1. 返回分页对象不为空<br>2. 数据列表包含2条记录<br>3. 正确调用DAO层查询方法 | 测试通过 |
| DRM-003 | saveDorm_Success | 验证新增宿舍功能 | 1. Mock DormDao<br>2. 准备新宿舍数据 | 1. 创建新宿舍对象(103号)<br>2. 设置最大人数为4<br>3. 调用saveDorm方法 | 1. 返回值为1<br>2. DAO层保存方法被调用<br>3. 保存的宿舍信息完整 | 测试通过 |
| DRM-004 | editDorm_Success | 验证编辑宿舍功能 | 1. Mock DormDao<br>2. 准备更新数据 | 1. 创建更新的宿舍对象<br>2. 修改最大人数为6<br>3. 调用editDorm方法 | 1. 返回值为1<br>2. DAO层更新方法被调用<br>3. 更新信息正确 | 测试通过 |
| DRM-005 | deleteDorms_Success | 验证批量删除宿舍功能 | 1. Mock DormDao<br>2. 准备删除数据列表 | 1. 创建要删除的宿舍列表<br>2. 包含两个宿舍对象<br>3. 调用deleteDorms方法 | 1. 返回值为2<br>2. DAO层批量删除方法被调用<br>3. 删除ID列表正确 | 测试通过 |

### 2.3 学生管理模块 (StudentServiceTest)
- 测试用例数量：5个
- 主要测试功能：
  - 分页查询学生信息
  - 查询不存在的学生场景
  - 新增学生
  - 编辑学生
  - 批量删除学生

#### 测试用例详情表

| 测试用例ID | 测试用例名称 | 测试目的 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 |
|------------|-------------|----------|----------|----------|----------|----------|
| STU-001 | getStudentByName_Success | 验证按姓名查询学生功能 | 1. Mock StudentDao<br>2. 准备测试数据 | 1. 设置查询条件"张三"<br>2. 调用getStudentByName方法<br>3. 设置分页参数(1,10) | 1. 返回分页对象不为空<br>2. 数据列表包含2条记录<br>3. 学生姓名包含"张三"和"张三丰" | 测试通过 |
| STU-002 | getStudentByName_NoResult | 验证查询不存在学生场景 | 1. Mock StudentDao<br>2. 设置空结果 | 1. 设置查询条件"不存在的学"<br>2. 调用getStudentByName方法 | 1. 返回分页对象不为空<br>2. 数据列表为空列表<br>3. 正确调用DAO层方法 | 测试通过 |
| STU-003 | saveStudent_Success | 验证新增学生功能 | 1. Mock StudentDao<br>2. 准备新学生数据 | 1. 创建新学生对象<br>2. 设置学号"2021003"<br>3. 调用saveStudent方法 | 1. 返回值为1<br>2. DAO层保存方法被调用<br>3. 学生基本信息完整 | 测试通过 |
| STU-004 | editStudent_Success | 验证编辑学生信息功能 | 1. Mock StudentDao<br>2. 准备更新数据 | 1. 创建更新的学生对象<br>2. 修改宿舍信息<br>3. 调用editStudent方法 | 1. 返回值为1<br>2. DAO层更新方法被调用<br>3. 更新信息正确 | 测试通过 |
| STU-005 | deleteStudents_Success | 验证批量删除学生功能 | 1. Mock StudentDao<br>2. 准备删除数据列表 | 1. 创建要删除的学生列表<br>2. 包含两个学生对象<br>3. 调用deleteStudents方法 | 1. 返回值为2<br>2. DAO层批量删除方法被调用<br>3. 删除ID列表正确 | 测试通过 |

### 2.4 用户管理模块 (UserServiceImplTest)
- 测试用例数量：8个
- 主要测试功能：
  - 用户认证与授权
  - 用户注册
  - 密码更新
  - 用户角色管理

#### 测试用例详情表

| 测试用例ID | 测试用例名称 | 测试目的 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 |
|------------|-------------|----------|----------|----------|----------|----------|
| USR-001 | loadUserByUsername_Success | 验证用户认证功能 | 1. Mock UserDao<br>2. 准备用户和角色数据 | 1. 设置用户名"testUser"<br>2. 模拟用户数据返回<br>3. 模拟角色数据返回<br>4. 调用loadUserByUsername方法 | 1. 返回UserDetails对象不为空<br>2. 用户名正确<br>3. 角色信息正确<br>4. 正确调用相关DAO方法 | 测试通过 |
| USR-002 | loadUserByUsername_UserNotFound | 验证用户不存在场景 | 1. Mock UserDao<br>2. 设置用户不存在 | 1. 设置不存在的用户名<br>2. 调用loadUserByUsername方法 | 1. 抛出UsernameNotFoundException异常<br>2. 正确调用DAO查询方法 | 测试通过 |
| USR-003 | userReg_Success | 验证用户注册功能 | 1. Mock UserDao<br>2. Mock PasswordEncoder | 1. 设置用户名和密码<br>2. 模拟密码加密<br>3. 调用userReg方法 | 1. 返回值为1<br>2. 密码正确加密<br>3. 用户信息正确保存 | 测试通过 |
| USR-004 | userReg_UserExists | 验证重复注册场景 | 1. Mock UserDao<br>2. 设置用户已存在 | 1. 设置已存在的用户名<br>2. 调用userReg方法 | 1. 返回值为-1<br>2. 不执行密码加密<br>3. 不执行保存操作 | 测试通过 |
| USR-005 | updateUserPassword_Success | 验证密码更新功能 | 1. Mock UserDao<br>2. Mock PasswordEncoder<br>3. 准备用户数据 | 1. 设置旧密码和新密码<br>2. 模拟密码匹配<br>3. 调用updateUserPassword方法 | 1. 返回true<br>2. 新密码正确加密<br>3. 密码更新成功 | 测试通过 |
| USR-006 | updateUserPassword_WrongOldPassword | 验证旧密码错误场景 | 1. Mock UserDao<br>2. Mock PasswordEncoder<br>3. 准备用户数据 | 1. 设置错误的旧密码<br>2. 模拟密码不匹配<br>3. 调用updateUserPassword方法 | 1. 返回false<br>2. 不执行密码更新<br>3. 正确验证旧密码 | 测试通过 |
| USR-007 | updateUserRole_Success | 验证更新用户角色功能 | 1. Mock UserRoleDao | 1. 设置用户ID和角色ID数组<br>2. 调用updateUserRole方法 | 1. 返回true<br>2. 正确删除原有角色<br>3. 正确添加新角色 | 测试通过 |
| USR-008 | updateUserRole_Failure | 验证角色更新失败场景 | 1. Mock UserRoleDao<br>2. 设置角色添加不完整 | 1. 设置用户ID和角色ID数组<br>2. 调用updateUserRole方法 | 1. 返回false<br>2. 删除原有角色<br>3. 新角色添加不完整 | 测试通过 |

## 3. 集成测试分析

### 3.1 概述
集成测试主要验证系统各个模块之间的交互和协作，确保不同服务组件能够正确地一起工作。测试类采用 Spring Boot Test 框架，使用 `@SpringBootTest` 注解进行完整的应用程序上下文加���并使用 `@Transactional` 注解确保测试数据的隔离性。

### 3.2 测试覆盖场景

#### 3.2.1 完整的宿舍分配流程 (testCompleteDormAllocationProcess)
- 测试用例数量：1个
- 主要测试流程：
  1. 创建新宿舍楼
  2. 在新宿舍楼中创建宿舍
  3. 分配学生到新宿舍
  4. 查询验证分配结果
- 验证要点：
  - 宿舍楼创建和查询
  - 宿舍创建和关联
  - 学生信息录入和宿舍分配
  - 各个环节的数据一致性

##### 测试用例详情表

| 步骤 | 测试内容 | 输入数据 | 测试步骤 | 预期结果 | 验证方法 |
|------|----------|----------|----------|----------|----------|
| 1 | 创建宿舍楼 | - 名称: "男生宿舍A栋"<br>- 类型: 1<br>- 备注: "测试用宿舍楼" | 1. 创建Building对象<br>2. 调用buildingService.saveBuilding | 1. 返回值 > 0<br>2. 宿舍楼创建成功 | assertTrue(buildingResult > 0) |
| 2 | 验证宿舍楼创建 | - 查询条件: 名称="男生宿舍A栋" | 1. 调用buildingService.getBuildingAll<br>2. 通过stream过滤目标宿舍楼 | 1. 列表不为空<br>2. 能找到新建宿舍楼<br>3. 宿舍楼信息正确 | 1. assertFalse(buildings.isEmpty())<br>2. assertNotNull(savedBuilding) |
| 3 | 创建宿舍 | - 宿舍号: "101"<br>- 所属楼栋: savedBuilding.getId()<br>- 最大容量: 4<br>- 备注: "测试用宿舍" | 1. 创建Dorm对象<br>2. 调用dormService.saveDorm | 1. 返回值 > 0<br>2. 宿舍创建成功 | assertTrue(dormResult > 0) |
| 4 | 验证宿舍创建 | - 查询条件: 宿舍号="101" | 1. 调用dormService.getDormPage<br>2. 过滤目标宿舍 | 1. 列表不为空<br>2. 宿舍号="101" | 1. assertFalse(dorms.isEmpty())<br>2. assertEquals("101", savedDorm.getName()) |
| 5 | 分配学生 | - 学号: "2021001"<br>- 姓名: "黄欣毅"<br>- 性别: 1<br>- 宿舍ID: savedDorm.getId() | 1. 创建Student对象<br>2. 调用studentService.saveStudent | 1. 返回值 > 0<br>2. 学生信息保存成功 | assertTrue(studentResult > 0) |
| 6 | 验证学生分配 | - 查询条件: 姓名="黄欣毅" | 1. 调用studentService.getStudentByName<br>2. 验证学生信息和宿舍分配 | 1. 列表不为空<br>2. 学生姓名正确<br>3. 宿舍分配正确 | 1. assertFalse(students.isEmpty())<br>2. assertEquals("黄欣毅", savedStudent.getStudentName())<br>3. assertEquals(savedDorm.getId(), savedStudent.getDormId()) |

#### 3.2.2 宿舍调整流程 (testDormReallocationProcess)
- 测试用例数量：1个
- 主要测试流程：
  1. 创建初始测试数据（宿舍楼、宿舍、学生）
  2. 执行学生宿舍调整
  3. 验证调整结果
- 验证要点：
  - 多宿舍楼场景下的宿舍分配
  - 学生宿舍调整��正确性
  - 数据更新的完整性

##### 测试用例详情表

| 步骤 | 测试内容 | 输入数据 | 测试步骤 | 预期结果 | 验证方法 |
|------|----------|----------|----------|----------|----------|
| 1 | 创建第一个宿舍楼 | - 名称: "男生宿舍B栋"<br>- 类型: 1<br>- 备注: "测试用宿舍楼" | 1. 创建Building对象(building1)<br>2. 调用buildingService.saveBuilding | 1. 宿舍楼创建成功<br>2. 数据正确保存 | 通过buildingService.saveBuilding的返回值验证 |
| 2 | 创建第二个宿舍楼 | - 名称: "男生宿舍C栋"<br>- 类型: 1<br>- 备注: "测试用宿舍楼" | 1. 创建Building对象(building2)<br>2. 调用buildingService.saveBuilding | 1. 宿舍楼创建成功<br>2. 数据正确保存 | 通过buildingService.saveBuilding的返回值验证 |
| 3 | 在第一个宿舍楼创建宿舍 | - 宿舍号: "201"<br>- 所属楼栋: building1.getId()<br>- 最大容量: 4<br>- 备注: "测试用宿舍" | 1. 创建Dorm对象(dorm1)<br>2. 调用dormService.saveDorm | 1. 宿舍创建成功<br>2. 关联到正确的宿舍楼 | 通过dormService.saveDorm的返回值验证 |
| 4 | 在第二个宿舍楼创建宿舍 | - 宿舍号: "202"<br>- 所属楼栋: building2.getId()<br>- 最大容量: 4<br>- 备注: "测试用宿舍" | 1. 创建Dorm对象(dorm2)<br>2. 调用dormService.saveDorm | 1. 宿舍创建成功<br>2. 关联到正确的宿舍楼 | 通过dormService.saveDorm的返回值验证 |
| 5 | 创建学生并分配到第一个宿舍 | - 学号: "2021002"<br>- 姓名: "李四"<br>- 性别: 1<br>- 宿舍ID: dorm1.getId() | 1. 创建Student对象<br>2. 调用studentService.saveStudent | 1. 学生信息保存成功<br>2. 初始宿舍分配正确 | 通过studentService.saveStudent的返回值验证 |
| 6 | 获取完整学生信息 | - 查询条件: 姓名="李四" | 1. 调用studentService.getStudentByName<br>2. 获取包含ID的完整学生信息 | 1. 查询结果不为空<br>2. 获取到完整学生信息 | 1. assertFalse(initialStudents.isEmpty())<br>2. 通过student对象赋值验证 |
| 7 | 调整学生宿舍分配 | - 学生对象: 已获取的完整student对象<br>- 新宿舍ID: dorm2.getId() | 1. 设置新的宿舍ID<br>2. 调用studentService.editStudent | 1. 返回值 > 0<br>2. 宿舍调整成功 | assertTrue(updateResult > 0) |
| 8 | 验证宿舍调整结果 | - 查询条件: 姓名="李四" | 1. 调用studentService.getStudentByName<br>2. 验证宿舍分配信息 | 1. 查询结果不为空<br>2. 新宿舍分配正确 | 1. assertFalse(updatedStudents.isEmpty())<br>2. assertEquals(dorm2.getId(), updatedStudent.getDormId()) |

#### 3.2.3 宿舍楼容量管理 (testDormCapacityManagement)
- 测试用例数量：1个
- 主要测试流程：
  1. 创建限定容量的宿舍
  2. 分配学生直到达到容量限制
  3. 验证容量限制
- 验证要点：
  - 宿舍容量限制的正确性
  - 学生分配的准确性
  - 容量统计的准确性

##### 测试用例详情表

| 步骤 | 测试内容 | 输入数据 | 测试步骤 | 预期结果 | 验证方法 |
|------|----------|----------|----------|----------|----------|
| 1 | 创建宿舍楼 | - 名称: "男生宿舍D栋"<br>- 类型: 1<br>- 备注: "测试用宿舍楼" | 1. 创建Building对象<br>2. 调用buildingService.saveBuilding | 1. 宿舍楼创建成功<br>2. 数据正确保存 | 通过buildingService.saveBuilding的返回值验证 |
| 2 | 创建限定容量宿舍 | - 宿舍号: "301"<br>- 所属楼栋: building.getId()<br>- 最大容量: 2<br>- 备注: "测试用宿舍" | 1. 创建Dorm对象<br>2. 调用dormService.saveDorm | 1. 宿舍创建成功<br>2. 容量限制设置正确 | 通过dormService.saveDorm的返回值验证 |
| 3 | 获取宿舍完整信息 | - 查询条件: 宿舍号="301" | 1. 调用dormService.getDormPage<br>2. 过滤目标宿舍<br>3. 获取完整宿舍信息 | 1. 查询结果不为空<br>2. 获取到完整宿舍信息 | 1. assertFalse(dorms.isEmpty())<br>2. 通过dorm对象赋值验证 |
| 4 | 分配第一个学生 | - 学号: "2021003"<br>- 姓名: "王五"<br>- 性别: 1<br>- 宿舍ID: dorm.getId() | 1. 创建Student对象(student1)<br>2. 调用studentService.saveStudent | 1. 返回值 > 0<br>2. 学生信息保存成功 | assertTrue(result1 > 0) |
| 5 | 分配第二个学生 | - 学号: "2021004"<br>- 姓名: "赵六"<br>- 性别: 1<br>- 宿舍ID: dorm.getId() | 1. 创建Student对象(student2)<br>2. 调用studentService.saveStudent | 1. 返回值 > 0<br>2. 学生信息保存成功 | assertTrue(result2 > 0) |
| 6 | 验证宿舍人数 | - 查询条件: 空（获取所有学生） | 1. 调用studentService.getStudentByName获取所有学生<br>2. 统计指定宿舍的学生数量 | 1. 查询结果不为空<br>2. 指定宿舍学生数量为2 | assertEquals(2, dormStudentCount) |
